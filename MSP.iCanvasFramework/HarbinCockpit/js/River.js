var map,
    mapMinWidth = 500,
    cities = new Object(),
    stations = new Object(),
    pmData, pmRanking,
    messageBoxHeight = 300,
    messageBoxMinHeight = 300,
    messageBoxWidth = 315,
    infoWindow = new BMap.InfoWindow("", { enableMessage: false, width: messageBoxWidth, height: messageBoxHeight });

function initialize() {
    map = new BMap.Map("map-canvas");
    center = new BMap.Point(126.657217, 45.731399);
    map.centerAndZoom(center, 8);
    //map.addControl(new BMap.NavigationControl());
    map.addControl(new BMap.ScaleControl());
    map.addControl(new BMap.OverviewMapControl());
    //map.addControl(new BMap.MapTypeControl());
    //map.enableScrollWheelZoom();
    map.disableScrollWheelZoom();
    map.disableContinuousZoom();
    map.disablePinchToZoom();
    map.disableDoubleClickZoom();
    //map.addEventListener("click", function (ev) {
    //    infoWindow.close();
    //    if (ev.overlay == null) {
    //        detailDialog.hide();
    //        detailChartDialog.hide();
    //    }
    //});
    //infoWindow.addEventListener("close", function (type, target, point) {

    //});
    colorForHarbin(map);
}

function colorForHarbin(mp) {
    var colorMap = new ColorMap(mp);
    //宾县、巴彦、依兰、延寿、木兰、通河、方正7个县，五常、双城、尚志3个县级市
    var colorOpt = [
       { "name": "哈尔滨市", color: "#C8C1E3" },
       { "name": "宾县", color: "#FBC5DC" },
       { "name": "巴彦县", color: "#DBEDC7" },
       { "name": "依兰县", color: "#E7CCAF" },
       { "name": "延寿县", color: "#DBEDC7" },
       { "name": "木兰县", color: "#FEFCBF" },
       { "name": "通河县", color: "#E7CCAF" },
       { "name": "方正县", color: "#C8C1E3" },
       { "name": "五常市", color: "#FBC5DC" },
       { "name": "双城市", color: "#C8C1E3" },
       { "name": "尚志市", color: "#FCFBBB" }
    ];
    //colorMap.setBGColorBatch(colorOpt);
    //setTimeout(function () { DrawRiver(map); MarkMarkers();}, 5000);
    MarkMarkers();
}


function MarkMarkers() {
    for (var i = 0; i < waterMinitor.length; i++) {
        var lat = waterMinitor[i]["纬度"];
        var lng = waterMinitor[i]["经度"]
        var iconUrl = getMarkIcon(waterMinitor[i]["本周水质"]);
        var opt = {};
        if (iconUrl != null) {
            opt.icon = new BMap.Icon(iconUrl, new BMap.Size(16, 16));
        }
        var mk = new BMap.Marker(new BMap.Point(lng, lat), opt);
        mk.setTitle(waterMinitor[i]["站点名称"]);
        map.addOverlay(mk);
    }
}

function getMarkIcon(quality) {
    switch (quality) {
        case "I":
            return "img/green_point.png";
        case "II":
            return "img/yellow_point.png";
        case "III":
            return "img/orange_point.png";
        case "IV":
            return "img/red_point.png";
        case "V":
            return "img/purple_point.png";
        case "劣V":
            return "img/gray_point.png";
        default:
            return "";
    }
}

function DrawRiver(mp) {
    //var r1 = "127.130398,44.852412;127.105102,44.87531;127.086705,44.90637;127.093604,44.929246;127.095903,44.945581;127.084405,44.966808;127.068308,44.991292;127.047611,45.015765;127.022314,45.033706;127.003917,45.059791;126.98552,45.076088;126.976321,45.102153;126.978621,45.123322;126.971722,45.142856;126.948725,45.139601;126.918829,45.147739;126.884335,45.149366;126.859038,45.147739;126.833742,45.142856;126.803846,45.149366;126.790048,45.172145;126.762452,45.185157;126.734857,45.185157;126.70956,45.198166;126.663567,45.203044;126.652069,45.22255;126.624473,45.240425;126.592277,45.253421;126.560082,45.253421;126.539385,45.246924;126.500291,45.246924;126.463496,45.246924;126.426702,45.246924;126.445099,45.232301;126.403705,45.233926;126.380709,45.217674;126.362311,45.199792;126.337015,45.198166;126.311719,45.185157;126.291022,45.180278;126.279523,45.167264;126.256527,45.16401;126.23353,45.152621;126.196736,45.160757;126.16914,45.150993;126.123146,45.154248;126.090951,45.165637;126.061056,45.177024;126.03116,45.177024;125.996665,45.181904;125.973668,45.190036;125.934574,45.206295;125.89548,45.224175;125.863285,45.2388;125.831089,45.250173;125.812692,45.27291;125.782796,45.295639;125.743702,45.316736;125.725305,45.341069;125.709207,45.357285;125.709207,45.3816;125.718406,45.407525;125.713807,45.435057;125.713807,45.460957;125.716106,45.485227;125.699103,45.508901";
    //var r2 = "125.699103,45.508901;125.720706,45.525655;125.743702,45.533737;125.768998,45.533737;125.791995,45.525655;125.82649,45.524038;125.858685,45.524038;125.886281,45.541818;125.906978,45.569283;125.925375,45.585434;125.936874,45.614492;125.941473,45.638696;125.95987,45.640309;125.985167,45.638696;125.998965,45.661277;125.996665,45.683848;126.015062,45.693519;126.026561,45.716077;126.063355,45.72091;126.086352,45.701576;126.118547,45.69513;126.136944,45.683848;126.162241,45.699965;126.182938,45.711244;126.199035,45.698354;126.231231,45.70641;126.261126,45.711244;126.286422,45.714466;126.314018,45.714466;126.339315,45.722521;126.364611,45.716077;126.387608,45.719299;126.389907,45.745068;126.417503,45.743457;126.4382,45.748288;126.463496,45.751508;126.489448,45.754391;126.499429,45.754225;126.510352,45.754627;126.514951,45.758249;126.512077,45.765493;126.514376,45.775149;126.523,45.779574;126.531624,45.779977;126.537948,45.777563;126.541397,45.773137;126.549446,45.767102;126.557495,45.764688;126.566694,45.764688;126.587391,45.764285;126.593715,45.768712;126.598889,45.775551;126.609812,45.784402;126.620736,45.789631;126.632809,45.794055;126.661555,45.805717;126.674203,45.808934;126.683976,45.811748;126.69605,45.816572;126.705823,45.823004;126.715022,45.831043;126.720771,45.842296;126.720771,45.851537;126.720196,45.862384;126.712147,45.876039;126.706973,45.8921;126.716172,45.898925;126.728245,45.904544;126.744918,45.908558;126.763315,45.91217;126.773663,45.921801;126.785737,45.92461;126.796085,45.929023;126.805859,45.932233;126.820231,45.939052;126.825406,45.947475;126.835179,45.951486;126.844953,45.959506;126.858176,45.968728;126.868524,45.975943;126.871399,45.983158;126.882897,45.989571;126.89727,45.994781;126.904744,45.999188;126.916817,45.99999;126.927741,46.000791;126.940964,46.006;126.944413,46.017216;126.946713,46.025627;126.952462,46.030834;126.967985,46.032435;126.980058,46.033236;126.994431,46.035239;127.008229,46.03684;127.026626,46.039243;127.040424,46.041645;127.059971,46.042846;127.069745,46.040844;127.078369,46.036039;127.096766,46.028431;127.107114,46.024426;127.118613,46.02002;127.132411,46.014412;127.147358,46.007202;127.158282,46.001192;127.170355,45.993979;127.183003,45.991575;127.196801,45.989972;127.206575,45.988369;127.220668,45.987105";
    //var r3 = "126.489448,45.754391;126.499429,45.754225;126.510352,45.754627;126.514951,45.758249;126.512077,45.765493;126.514376,45.775149;126.523,45.779574;126.531624,45.779977;126.537948,45.777563;126.541397,45.773137;126.549446,45.767102;126.557495,45.764688;126.566694,45.764688;126.587391,45.764285;126.593715,45.768712;126.598889,45.775551;126.609812,45.784402;126.620736,45.789631;126.632809,45.794055;126.661555,45.805717;126.674203,45.808934;126.683976,45.811748;126.69605,45.816572;126.705823,45.823004;126.715022,45.831043;126.720771,45.842296;126.720771,45.851537;126.720196,45.862384;126.712147,45.876039;126.706973,45.8921;126.716172,45.898925;126.728245,45.904544;126.744918,45.908558;126.763315,45.91217;126.773663,45.921801;126.785737,45.92461;126.796085,45.929023;126.805859,45.932233;126.820231,45.939052;126.825406,45.947475;126.835179,45.951486;126.844953,45.959506;126.858176,45.968728;126.868524,45.975943;126.871399,45.983158;126.882897,45.989571;126.89727,45.994781;126.904744,45.999188;126.916817,45.99999;126.927741,46.000791;126.940964,46.006;126.944413,46.017216;126.946713,46.025627;126.952462,46.030834;126.967985,46.032435;126.980058,46.033236;126.994431,46.035239;127.008229,46.03684;127.026626,46.039243;127.040424,46.041645;127.059971,46.042846;127.069745,46.040844;127.078369,46.036039;127.096766,46.028431;127.107114,46.024426;127.118613,46.02002;127.132411,46.014412;127.147358,46.007202;127.158282,46.001192;127.170355,45.993979;127.183003,45.991575;127.196801,45.989972;127.206575,45.988369;127.220668,45.987105";
    var r1 = "125.699103,45.508901;125.699721,45.517066;125.70662,45.520704;125.715819,45.521916;125.725017,45.523937;125.733641,45.525554;125.74054,45.527978;125.749739,45.530403;125.760087,45.532423;125.772735,45.530403;125.779059,45.525554;125.785384,45.521916;125.791133,45.515854;125.803206,45.517875;125.814129,45.519896;125.829652,45.523129;125.8423,45.527574;125.853224,45.524745;125.862422,45.526362;125.876795,45.534848;125.885419,45.541313;125.895192,45.54818;125.900942,45.555451;125.904966,45.564337;125.913015,45.572413;125.922788,45.580084;125.933712,45.580892;125.940611,45.573624;125.951534,45.570798;125.964757,45.575643;125.978555,45.57322;125.987179,45.575643;125.983154,45.584929;125.975681,45.593406;125.970506,45.6039;125.975681,45.611567;125.984304,45.614391;125.991778,45.617215;126.001552,45.620847;126.01075,45.629721;126.018799,45.634562;126.030298,45.633352;126.038921,45.632142;126.051569,45.632142;126.055594,45.638192;126.063643,45.641821;126.072841,45.645451;126.08319,45.653919;126.085489,45.662385;126.086064,45.671657;126.088364,45.68012;126.096988,45.682135;126.108486,45.681732;126.122859,45.682538;126.136657,45.681732;126.147005,45.681329;126.156779,45.689792;126.164253,45.704296;126.174601,45.707115;126.1861,45.699864;126.197023,45.69503;126.214845,45.699059;126.228643,45.703893;126.244741,45.707115;126.261414,45.707921;126.275212,45.708727;126.286135,45.70631;126.297633,45.705101;126.312006,45.703893;126.323504,45.707115;126.338452,45.713157;126.3511,45.712755;126.359149,45.712352;126.367773,45.707921;126.374672,45.707921;126.380996,45.710338;126.381571,45.721615;126.379271,45.728058;126.382146,45.7345;126.392494,45.737318;126.406292,45.742149;126.41894,45.743357;126.433888,45.744967;126.444237,45.746577;126.451136,45.744967;126.464359,45.748187;126.471833,45.752615;126.478732,45.755432;126.489448,45.754391;126.502303,45.755029;126.514376,45.757847;126.512077,45.768309;126.517826,45.777161;126.528174,45.780781;126.537373,45.777965;126.547147,45.768712;126.582216,45.771528;126.601764,45.781184;126.614987,45.790033;126.631084,45.795261;126.637983,45.805315;126.648332,45.814964;126.667304,45.820994;126.688001,45.823808;126.714447,45.83466;126.721346,45.848725;126.718471,45.866802;126.708123,45.883669;126.714447,45.901735;126.73112,45.908558;126.745492,45.909361;126.76389,45.913775;126.774238,45.920998;126.784587,45.925412;126.797235,45.929825;126.810458,45.93464;126.818507,45.943464;126.824831,45.949079;126.836329,45.956699;126.846678,45.963916;126.857601,45.968327;126.868524,45.976344;126.878298,45.987166;126.888646,45.993979;126.913943,46.001993;126.929465,46.003996;126.942688,46.007602;126.946713,46.025627;126.966835,46.030834;126.986382,46.034838;127.026051,46.038842";
    var point1ColorStr = "125.697996,45.50878;125.697924,45.509487;125.698428,45.509942;125.699146,45.509993;125.699793,45.50974;125.70008,45.509083;125.700009,45.508426;125.69929,45.508123;125.698499,45.508022";

    var pointsArr1 = []; ar1 = r1.split(';');
    //var Lastlat1 = ar1[ar1.length].split(',')[0];
    ar1.forEach(function (value, index, arr) {
        var ar2 = value.split(',');
        pointsArr1.push(new BMap.Point(parseFloat(ar2[0]), parseFloat(ar2[1])));
    });
    var polyline1 = new BMap.Polyline(pointsArr1, { strokeColor: "blue", strokeWeight: 6 });
    map.addOverlay(polyline1);
}


function getWaterQualityColor(lat, lng) {
    var quality, color;
    for (var i = 0; i < waterMinitor.length; i++) {
        if (lat == waterMinitor[i]["经度"] && lng == waterMinitor[i]["纬度"]) {
            quality = waterMinitor[i]["本周水质"];
            break;
        }
    }
    for (var j = 0; j < waterQuality.length; j++) {
        if (quality == waterQuality[j]["水质级别"]) {
            color = waterQuality[j]["色值"];
            break;
        }
    }
    return color;
}

$(function () {
    document.body.onload = function () {
        initialize();
    }
});



